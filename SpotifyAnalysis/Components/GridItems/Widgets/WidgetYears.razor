@namespace SpotifyAnalysis.Components
@using ApexCharts

@inherits WidgetBase

@using Data.DTO
@using SpotifyAnalysis.Data

@if (elements is not null) {
    @CreateChart(typeof(MudItemAreaChart))
}

@code {
    [Parameter, EditorRequired]
    public IEnumerable<TrackDTO> Tracks { get; set; }
    public override string Title { get; } = "Release years";

    protected override Elements BuildElements() {
        var elements = new Elements();
        if (Tracks is null)
            return elements;

        int[] timeline = new int[DateTime.Now.Year];
        foreach (var track in Tracks)
            timeline[int.Parse(track.Album.ReleaseDate.Substring(0, 4))]++;

        timeline[0] = 0;  // Some albums have 0000 as release year - remove these

        int minYear = Math.Min(timeline.Select((e, index) => (e, index)).FirstOrDefault(t => t.e > 0).index, 2000);
        for (int i = minYear; i < timeline.Length; i++)
            elements.Increase(new() { Label = i.ToString(), Quantity = timeline[i] });

        return elements;
    }
}
